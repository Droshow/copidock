{"format_version":"1.2","terraform_version":"1.5.7","variables":{"name":{"value":"copidock"},"region":{"value":"eu-central-1"}},"planned_values":{"root_module":{"child_modules":[{"resources":[{"address":"module.storage.random_id.suffix","mode":"managed","type":"random_id","name":"suffix","provider_name":"registry.terraform.io/hashicorp/random","schema_version":0,"values":{"byte_length":4,"keepers":null,"prefix":null},"sensitive_values":{}}],"address":"module.storage"}]}},"resource_changes":[{"address":"module.storage.random_id.suffix","module_address":"module.storage","mode":"managed","type":"random_id","name":"suffix","provider_name":"registry.terraform.io/hashicorp/random","change":{"actions":["create"],"before":null,"after":{"byte_length":4,"keepers":null,"prefix":null},"after_unknown":{"b64_std":true,"b64_url":true,"dec":true,"hex":true,"id":true},"before_sensitive":false,"after_sensitive":{}}}],"configuration":{"provider_config":{"aws":{"name":"aws","full_name":"registry.terraform.io/hashicorp/aws","expressions":{"region":{"references":["var.region"]}}},"module.storage:random":{"name":"random","full_name":"registry.terraform.io/hashicorp/random","module_address":"module.storage"}},"root_module":{"outputs":{"api_url":{"expression":{"references":["module.api.api_url","module.api"]},"description":"API Gateway endpoint URL"},"bucket":{"expression":{"references":["module.storage.bucket_name","module.storage"]},"description":"S3 bucket name"},"dynamodb_tables":{"expression":{"references":["module.dynamo_db.chunks_table_name","module.dynamo_db","module.dynamo_db.tokens_table_name","module.dynamo_db","module.dynamo_db.threads_table_name","module.dynamo_db","module.dynamo_db.events_table_name","module.dynamo_db"]},"description":"DynamoDB table names"}},"module_calls":{"api":{"source":"./modules/api","expressions":{"lambda_arn":{"references":["module.compute_lambda.notes_lambda_arn","module.compute_lambda"]},"lambda_function_name":{"references":["module.compute_lambda.notes_lambda_function_name","module.compute_lambda"]},"name":{"references":["var.name"]}},"module":{"outputs":{"api_id":{"expression":{"references":["aws_apigatewayv2_api.http.id","aws_apigatewayv2_api.http"]},"description":"API Gateway ID"},"api_url":{"expression":{"references":["aws_apigatewayv2_api.http.api_endpoint","aws_apigatewayv2_api.http"]},"description":"API Gateway endpoint URL"}},"resources":[{"address":"aws_apigatewayv2_api.http","mode":"managed","type":"aws_apigatewayv2_api","name":"http","provider_config_key":"aws","expressions":{"name":{"references":["var.name"]},"protocol_type":{"constant_value":"HTTP"}},"schema_version":0},{"address":"aws_apigatewayv2_integration.notes","mode":"managed","type":"aws_apigatewayv2_integration","name":"notes","provider_config_key":"aws","expressions":{"api_id":{"references":["aws_apigatewayv2_api.http.id","aws_apigatewayv2_api.http"]},"integration_type":{"constant_value":"AWS_PROXY"},"integration_uri":{"references":["var.lambda_arn"]},"payload_format_version":{"constant_value":"2.0"}},"schema_version":0},{"address":"aws_apigatewayv2_route.post_notes","mode":"managed","type":"aws_apigatewayv2_route","name":"post_notes","provider_config_key":"aws","expressions":{"api_id":{"references":["aws_apigatewayv2_api.http.id","aws_apigatewayv2_api.http"]},"route_key":{"constant_value":"POST /notes"},"target":{"references":["aws_apigatewayv2_integration.notes.id","aws_apigatewayv2_integration.notes"]}},"schema_version":0},{"address":"aws_apigatewayv2_stage.default","mode":"managed","type":"aws_apigatewayv2_stage","name":"default","provider_config_key":"aws","expressions":{"api_id":{"references":["aws_apigatewayv2_api.http.id","aws_apigatewayv2_api.http"]},"auto_deploy":{"constant_value":true},"name":{"constant_value":"$default"}},"schema_version":0},{"address":"aws_lambda_permission.apigw","mode":"managed","type":"aws_lambda_permission","name":"apigw","provider_config_key":"aws","expressions":{"action":{"constant_value":"lambda:InvokeFunction"},"function_name":{"references":["var.lambda_function_name"]},"principal":{"constant_value":"apigateway.amazonaws.com"},"source_arn":{"references":["aws_apigatewayv2_api.http.execution_arn","aws_apigatewayv2_api.http"]},"statement_id":{"constant_value":"AllowExecutionFromAPIGateway"}},"schema_version":0}],"variables":{"lambda_arn":{"description":"ARN of the Lambda function"},"lambda_function_name":{"description":"Name of the Lambda function"},"name":{"description":"Name prefix for resources"}}}},"compute_lambda":{"source":"./modules/compute_lambda","expressions":{"bucket_arn":{"references":["module.storage.bucket_arn","module.storage"]},"bucket_name":{"references":["module.storage.bucket_name","module.storage"]},"ddb_chunks_table":{"references":["module.dynamo_db.chunks_table_name","module.dynamo_db"]},"ddb_events_table":{"references":["module.dynamo_db.events_table_name","module.dynamo_db"]},"ddb_threads_table":{"references":["module.dynamo_db.threads_table_name","module.dynamo_db"]},"ddb_tokens_table":{"references":["module.dynamo_db.tokens_table_name","module.dynamo_db"]},"name":{"references":["var.name"]},"table_arns":{"references":["module.dynamo_db.table_arns","module.dynamo_db"]}},"module":{"outputs":{"notes_lambda_arn":{"expression":{"references":["aws_lambda_function.notes.arn","aws_lambda_function.notes"]},"description":"ARN of the notes Lambda function"},"notes_lambda_function_name":{"expression":{"references":["aws_lambda_function.notes.function_name","aws_lambda_function.notes"]},"description":"Name of the notes Lambda function"}},"resources":[{"address":"aws_iam_role.lambda_role","mode":"managed","type":"aws_iam_role","name":"lambda_role","provider_config_key":"aws","expressions":{"assume_role_policy":{},"name":{"references":["var.name"]}},"schema_version":0},{"address":"aws_iam_role_policy.lambda_inline","mode":"managed","type":"aws_iam_role_policy","name":"lambda_inline","provider_config_key":"aws","expressions":{"policy":{"references":["data.aws_iam_policy_document.lambda_inline.json","data.aws_iam_policy_document.lambda_inline"]},"role":{"references":["aws_iam_role.lambda_role.id","aws_iam_role.lambda_role"]}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.lambda_basic","mode":"managed","type":"aws_iam_role_policy_attachment","name":"lambda_basic","provider_config_key":"aws","expressions":{"policy_arn":{"constant_value":"arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"},"role":{"references":["aws_iam_role.lambda_role.name","aws_iam_role.lambda_role"]}},"schema_version":0},{"address":"aws_lambda_function.notes","mode":"managed","type":"aws_lambda_function","name":"notes","provider_config_key":"aws","expressions":{"environment":[{"variables":{"references":["var.bucket_name","var.ddb_chunks_table","var.ddb_tokens_table","var.ddb_threads_table","var.ddb_events_table"]}}],"filename":{"references":["path.module"]},"function_name":{"references":["var.name"]},"handler":{"constant_value":"notes_handler.handler"},"role":{"references":["aws_iam_role.lambda_role.arn","aws_iam_role.lambda_role"]},"runtime":{"constant_value":"python3.11"}},"schema_version":0},{"address":"data.aws_iam_policy_document.lambda_inline","mode":"data","type":"aws_iam_policy_document","name":"lambda_inline","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["s3:PutObject","s3:GetObject","s3:DeleteObject"]},"resources":{"references":["var.bucket_arn"]}},{"actions":{"constant_value":["dynamodb:PutItem","dynamodb:GetItem","dynamodb:UpdateItem","dynamodb:Query","dynamodb:BatchWriteItem"]},"resources":{"references":["var.table_arns"]}}]},"schema_version":0}],"variables":{"bucket_arn":{"description":"S3 bucket ARN"},"bucket_name":{"description":"S3 bucket name"},"ddb_chunks_table":{"description":"DynamoDB chunks table name"},"ddb_events_table":{"description":"DynamoDB events table name"},"ddb_threads_table":{"description":"DynamoDB threads table name"},"ddb_tokens_table":{"description":"DynamoDB tokens table name"},"name":{"description":"Name prefix for resources"},"table_arns":{"description":"List of DynamoDB table ARNs"}}}},"dynamo_db":{"source":"./modules/dynamo_db","expressions":{"name":{"references":["var.name"]}},"module":{"outputs":{"chunks_table_name":{"expression":{"references":["aws_dynamodb_table.chunks.name","aws_dynamodb_table.chunks"]},"description":"Name of the chunks DynamoDB table"},"events_table_name":{"expression":{"references":["aws_dynamodb_table.events.name","aws_dynamodb_table.events"]},"description":"Name of the events DynamoDB table"},"table_arns":{"expression":{"references":["aws_dynamodb_table.chunks.arn","aws_dynamodb_table.chunks","aws_dynamodb_table.tokens.arn","aws_dynamodb_table.tokens","aws_dynamodb_table.threads.arn","aws_dynamodb_table.threads","aws_dynamodb_table.events.arn","aws_dynamodb_table.events"]},"description":"ARNs of all DynamoDB tables"},"threads_table_name":{"expression":{"references":["aws_dynamodb_table.threads.name","aws_dynamodb_table.threads"]},"description":"Name of the threads DynamoDB table"},"tokens_table_name":{"expression":{"references":["aws_dynamodb_table.tokens.name","aws_dynamodb_table.tokens"]},"description":"Name of the tokens DynamoDB table"}},"resources":[{"address":"aws_dynamodb_table.chunks","mode":"managed","type":"aws_dynamodb_table","name":"chunks","provider_config_key":"aws","expressions":{"attribute":[{"name":{"constant_value":"ns"},"type":{"constant_value":"S"}},{"name":{"constant_value":"sort"},"type":{"constant_value":"S"}}],"billing_mode":{"constant_value":"PAY_PER_REQUEST"},"hash_key":{"constant_value":"ns"},"name":{"references":["var.name"]},"range_key":{"constant_value":"sort"},"tags":{"references":["var.name"]}},"schema_version":1},{"address":"aws_dynamodb_table.events","mode":"managed","type":"aws_dynamodb_table","name":"events","provider_config_key":"aws","expressions":{"attribute":[{"name":{"constant_value":"thread_id"},"type":{"constant_value":"S"}},{"name":{"constant_value":"at"},"type":{"constant_value":"S"}}],"billing_mode":{"constant_value":"PAY_PER_REQUEST"},"hash_key":{"constant_value":"thread_id"},"name":{"references":["var.name"]},"range_key":{"constant_value":"at"},"tags":{"references":["var.name"]}},"schema_version":1},{"address":"aws_dynamodb_table.threads","mode":"managed","type":"aws_dynamodb_table","name":"threads","provider_config_key":"aws","expressions":{"attribute":[{"name":{"constant_value":"thread_id"},"type":{"constant_value":"S"}}],"billing_mode":{"constant_value":"PAY_PER_REQUEST"},"hash_key":{"constant_value":"thread_id"},"name":{"references":["var.name"]},"tags":{"references":["var.name"]}},"schema_version":1},{"address":"aws_dynamodb_table.tokens","mode":"managed","type":"aws_dynamodb_table","name":"tokens","provider_config_key":"aws","expressions":{"attribute":[{"name":{"constant_value":"tok"},"type":{"constant_value":"S"}},{"name":{"constant_value":"ns_ts_id"},"type":{"constant_value":"S"}}],"billing_mode":{"constant_value":"PAY_PER_REQUEST"},"hash_key":{"constant_value":"tok"},"name":{"references":["var.name"]},"range_key":{"constant_value":"ns_ts_id"},"tags":{"references":["var.name"]}},"schema_version":1}],"variables":{"name":{"description":"Name prefix for resources"}}}},"storage":{"source":"./modules/storage","expressions":{"name":{"references":["var.name"]}},"module":{"outputs":{"bucket_arn":{"expression":{"references":["aws_s3_bucket.copidock.arn","aws_s3_bucket.copidock"]},"description":"ARN of the S3 bucket"},"bucket_name":{"expression":{"references":["aws_s3_bucket.copidock.bucket","aws_s3_bucket.copidock"]},"description":"Name of the S3 bucket"}},"resources":[{"address":"aws_s3_bucket.copidock","mode":"managed","type":"aws_s3_bucket","name":"copidock","provider_config_key":"aws","expressions":{"bucket":{"references":["var.name","random_id.suffix.hex","random_id.suffix"]}},"schema_version":0},{"address":"aws_s3_bucket_public_access_block.copidock","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"copidock","provider_config_key":"aws","expressions":{"block_public_acls":{"constant_value":true},"block_public_policy":{"constant_value":true},"bucket":{"references":["aws_s3_bucket.copidock.id","aws_s3_bucket.copidock"]},"ignore_public_acls":{"constant_value":true},"restrict_public_buckets":{"constant_value":true}},"schema_version":0},{"address":"aws_s3_bucket_server_side_encryption_configuration.copidock","mode":"managed","type":"aws_s3_bucket_server_side_encryption_configuration","name":"copidock","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.copidock.id","aws_s3_bucket.copidock"]},"rule":[{"apply_server_side_encryption_by_default":[{"sse_algorithm":{"constant_value":"AES256"}}]}]},"schema_version":0},{"address":"aws_s3_bucket_versioning.copidock","mode":"managed","type":"aws_s3_bucket_versioning","name":"copidock","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.copidock.id","aws_s3_bucket.copidock"]},"versioning_configuration":[{"status":{"constant_value":"Enabled"}}]},"schema_version":0},{"address":"random_id.suffix","mode":"managed","type":"random_id","name":"suffix","provider_config_key":"module.storage:random","expressions":{"byte_length":{"constant_value":4}},"schema_version":0}],"variables":{"name":{"description":"Name prefix for resources"}}}}},"variables":{"name":{"default":"copidock","description":"Name prefix for all resources"},"region":{"default":"eu-central-1","description":"The AWS region to deploy resources in"}}}},"timestamp":"2025-08-29T17:13:15Z"}

---
thread_id: smart-copidock-2025-09-22
snapshot_id: template-intelligence-v1
version: 1
created_at: 2025-09-22T19:45:00.000Z
repo: copidock
branch: main
goal: "Build intelligent CLI-driven template system with progressive enhancement"
context_tags: ["templating","cli","ux","intelligence","personas"]
related_paths:
  - copidock/templates/personas/senior-backend-dev.yml
  - copidock/cli/main.py
  - copidock/cli/synthesis.py
  - copidock/templates/loader.py
token_budget_hint: 6k
---

# Rehydrate: Intelligent Template System - Phase 2 CLI Enhancement (v1)

## Operator Instructions
You are a senior product engineer helping me build an intelligent CLI experience.  
**Goal:** Transform static YAML templates into smart, CLI-driven context-aware snapshots.  
**Do:**
- Enhance CLI with interactive template parameters
- Build smart context detection from git/files
- Create progressive user preference learning
- Maintain simplicity while adding intelligence
**Don't:** over-engineer, add LLM dependencies, or complicate core workflow.

**Primary Tasks**
1. Design enhanced CLI interface with `--focus`, `--output`, `--constraints` parameters
2. Implement smart context detection from git patterns and file changes
3. Create template preference persistence and learning system
4. Build interactive template enhancement workflow

**Expected Outputs**
- Enhanced CLI command structure with intelligent defaults
- Smart context detection algorithms (no LLM needed)
- Template preference saving/loading system
- Interactive workflow for progressive enhancement

## Current State
**Template System Status:** ✅ WORKING PERFECTLY
- YAML persona loading functional (senior-backend-dev.yml)
- File categorization working (13 files across 5 categories)
- Synthesis generation operational (4 intelligent sections)
- Comprehensive snapshots creating successfully

**Intelligence Gap Identified:**
```
Current: **Primary Focus**: infrastructure and deployment (STATIC)
Vision:  **Primary Focus**: Fix authentication bug in Lambda API (DYNAMIC)

Current: Generic tasks from YAML rules
Vision:  Context-aware tasks based on actual work
```

**User Experience Issues:**
- Template content too generic/static
- No user input mechanism for context
- Rehydrate command doesn't display comprehensive content
- Missing progressive learning from user patterns

## Decisions & Constraints
- **No LLM Integration**: Keep system deterministic and fast
- **CLI-First**: Interactive parameters over config files
- **Progressive Enhancement**: Start simple, learn user patterns
- **Backward Compatibility**: Don't break existing `--comprehensive` flag
- **User Control**: Smart defaults with easy overrides

**Technical Constraints:**
- Python CLI with typer framework
- YAML-based template system
- Git-based context detection
- Local preference persistence

## Open Questions
1. **CLI Design**: How many parameters before it becomes overwhelming?
2. **Context Detection**: Which git/file patterns provide most value?
3. **Learning System**: Store preferences per-repo or globally?
4. **Interactive Mode**: Full wizard or smart prompts only?

## Next Development Phase

### Phase 2A: Enhanced CLI Parameters
```bash
# Target CLI experience
copidock snapshot create --comprehensive \
  --focus "API debugging" \
  --output "Working auth endpoint" \
  --constraints "backward compatibility" \
  --persona senior-backend-dev
```

### Phase 2B: Smart Context Detection
```python
# Auto-detect from:
- Git branch names (fix/auth-bug → debugging focus)
- File change patterns (terraform → infrastructure focus)
- Commit message analysis (recent patterns)
- Repository technology stack
```

### Phase 2C: Progressive Learning
```bash
# Save successful templates
copidock template save "auth-debugging-session"
copidock template list
copidock template use "auth-debugging-session"
```

### Phase 2D: Interactive Enhancement
```bash
# Smart prompts for missing context
copidock snapshot create --comprehensive --interactive
> Auto-detected focus: "Infrastructure deployment"
> What's your expected output? [Tested deployment plan]: _
```

## Architecture Evolution

**Current Architecture:**
```
Static YAML → Template Loader → Generic Instructions
```

**Target Architecture:**
```
Context Detection → User Input → Smart Defaults → Enhanced Template → Intelligent Instructions
```

**Implementation Priority:**
1. **CLI Parameters** (immediate value)
2. **Context Detection** (smart defaults)
3. **Preference Learning** (progressive enhancement)
4. **Interactive Mode** (polish)

## Success Metrics
- **User Adoption**: Developers choose `--comprehensive` over basic snapshots
- **Content Quality**: Instructions become project-specific and actionable
- **Workflow Integration**: Natural part of development cycle
- **Progressive Value**: System learns and improves user experience over time

## Technical Implementation Notes

**Enhanced CLI Command Structure:**
```python
@app.command("snapshot")
def snapshot_cmd(
    action: str = typer.Argument(...),
    comprehensive: bool = typer.Option(False, "--comprehensive"),
    persona: str = typer.Option("senior-backend-dev", "--persona"),
    focus: Optional[str] = typer.Option(None, "--focus"),
    output: Optional[str] = typer.Option(None, "--output"),
    constraints: Optional[str] = typer.Option(None, "--constraints"),
    interactive: bool = typer.Option(False, "--interactive"),
    auto_detect: bool = typer.Option(True, "--auto-detect"),
):
```

**Smart Context Detection Functions:**
```python
def detect_focus_from_context(repo_root, recent_commits, changed_files):
    # Git branch analysis
    # File change patterns
    # Commit message mining
    # Return suggested focus
    
def suggest_output_from_goal(goal, focus, file_categories):
    # Based on common patterns
    # Return likely deliverable
```

The template system foundation is solid - now we build intelligence on top of it!
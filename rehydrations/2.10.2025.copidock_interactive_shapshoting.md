---
thread_id: copidock-phase-interactive-2025-09-26
snapshot_id: interactive-cli-spec-v1
version: 1
created_at: 2025-09-26T00:00:00Z
repo: copidock
branch: main
goal: "Design & implement deterministic `--interactive` flow for snapshot creation"
context_tags: ["cli","ux","templating","deterministic","interactive","snapshots"]
related_paths:
  - copidock/cli/main.py
  - copidock/cli/synthesis.py
  - copidock/cli/gather.py
  - copidock/templates/personas/senior-backend-dev.yml
  - copidock/templates/loader.py
token_budget_hint: 5k
---

# Rehydrate: Copidock Interactive Snapshot (v1)

## Operator Instructions
You are a senior product engineer implementing a **deterministic interactive workflow** for Copidock.  
**Goal:** add `--interactive` to guide users through key fields (focus, expected output, constraints), auto-detect what we can, and produce a **repeatable** Markdown snapshot.

**Do:**
- Keep generation **deterministic** (no LLMs).  
- Reuse existing templates/personas; only fill gaps interactively.  
- Provide smart defaults from repo context; let user override quickly.  
- Validate inputs; show a final preview before submit.

**Don’t:**
- Add heavy UI or background daemons.  
- Increase scope beyond the snapshot path (no hooks, no online auth).  
- Make any non-reproducible calls.

**Expected Outputs**
1. Working `copidock snapshot create --interactive` that:
   - prompts for `focus`, `output`, `constraints` (with defaults),
   - shows a **one-screen summary**,
   - writes snapshot Markdown locally and posts to `/snapshot`.
2. `synthesis.py` utilities to assemble sections deterministically.  
3. Updated template loader supporting persona defaults + CLI overrides.  
4. Help text & README examples.

---

## Current State (summary)
- CLI supports `snapshot create --auto` (deterministic, git-aware).  
- Persona YAMLs load and render static/parametrized content.  
- No guided input flow; users must pass flags or edit files manually.

---

## Decisions & Constraints
- **Deterministic first:** same inputs → same outputs.  
- **CLI-first UX:** Typer-based prompts only.  
- **No LLM dependency:** optional later flag may appear, not now.  
- **Token budget:** keep final snapshot ≤ 5k tokens.  
- **Back-compat:** all current flags continue to work.

---

## Proposed CLI UX

```bash
# Simple, guided session
copidock snapshot create --interactive [--persona senior-backend-dev] [--auto] [--since "3 days"]

# Flow (example)
> Detected repo: copidock (branch: main)
> Suggested focus: "Infrastructure hardening" (from recent changes)
Focus [Infrastructure hardening]: API debugging
Expected output [Deployment plan]: Working auth endpoint
Constraints [cost-sensitive, no VPC]: backward compatibility, no downtime
Persona [senior-backend-dev]: senior-backend-dev

> Summary:
  Focus: API debugging
  Output: Working auth endpoint
  Constraints: backward compatibility, no downtime
  Persona: senior-backend-dev
  Auto-detected files: 7 (filtered, ≤6k tokens)
Proceed? [Y/n]: Y

✔ Snapshot created: snapshots/2025-09-26/interactive-v1.md
✔ Uploaded to S3 via /snapshot (vNNN)

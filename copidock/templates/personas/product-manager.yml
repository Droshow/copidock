derive_template_vars
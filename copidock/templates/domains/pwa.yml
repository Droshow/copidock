domain: pwa
display_name: "Progressive Web App"
description: "Offline-capable, installable web applications with native-like experiences"

additional_questions:
  - prompt: "ðŸ”Œ Offline capabilities needed?"
    help_text: "Should app work without internet? What features need to be available offline?"
    key: offline_strategy
    default: "Full offline support with background sync"
  
  - prompt: "ðŸ“± Installation requirements?"
    help_text: "Add to home screen? Push notifications? App icon and splash screen?"
    key: installation_features
    default: "Installable with push notifications"
  
  - prompt: "ðŸ”„ Data sync strategy?"
    help_text: "How does data sync when back online? Handle conflicts?"
    key: sync_approach
    default: "Background sync with conflict resolution"

  - prompt: "ðŸ“¦ Asset caching strategy?"
    help_text: "What should be cached? Cache-first or network-first? Versioning?"
    key: caching_strategy
    default: "Cache-first for assets, network-first for data"

synthesis_hints:
  technical_approach: |
    **PWA Architecture Recommendations**:
    - Service Worker for offline functionality and request interception
    - IndexedDB for local data storage (5-50MB depending on browser)
    - Background Sync API for reliable data synchronization
    - Push Notification API for user engagement (note: iOS Safari limitations)
    - Web App Manifest for installation and branding
    - Cache API with versioned cache names for asset management
    - Network-first with cache fallback for dynamic content
    - Cache-first with stale-while-revalidate for static assets
    
    **Key Implementation Patterns**:
    - Workbox library for service worker management
    - App Shell architecture for instant loading
    - Lazy loading for code splitting and performance
    - Periodic background sync for data freshness
    
  technology_stack: |
    **Frontend Framework Options**:
    - React with Next.js PWA plugin or Create React App + Workbox
    - Vue.js with Vue CLI PWA plugin or Nuxt.js
    - Svelte/SvelteKit with adapter-static and workbox
    - Vanilla JS with Workbox for lightweight apps
    
    **State Management & Persistence**:
    - Redux/Zustand with redux-persist or zustand/middleware
    - Dexie.js (IndexedDB wrapper) for structured data
    - localForage for simple key-value storage
    
    **Build & Development Tools**:
    - Vite or Webpack with Workbox plugin
    - Lighthouse for PWA auditing and performance
    - Chrome DevTools Application tab for debugging
    
    **Backend Considerations**:
    - RESTful API with versioning (e.g., /api/v1/)
    - GraphQL with subscriptions for real-time updates
    - JWT authentication with refresh token strategy
    - CORS properly configured for web origins
    
  risks: |
    **PWA-Specific Risks & Mitigations**:
    
    1. **iOS Safari Limitations** (HIGH)
       - Risk: No push notifications, limited storage (50MB), service worker restrictions
       - Mitigation: Feature detection, graceful degradation, alternative engagement strategies
    
    2. **Service Worker Update Complexity** (MEDIUM)
       - Risk: Old service workers can cache indefinitely, users stuck on old version
       - Mitigation: Implement skipWaiting strategy, force update prompts, versioned cache names
    
    3. **Cache Invalidation** (MEDIUM)
       - Risk: Stale data served from cache, users see outdated content
       - Mitigation: Cache busting with hashes, stale-while-revalidate, manual refresh option
    
    4. **Storage Quota Management** (MEDIUM)
       - Risk: Browser storage limits (5-50MB varies), quota exceeded errors
       - Mitigation: Monitor storage usage, implement LRU cache eviction, request persistent storage
    
    5. **Network/Cache Race Conditions** (LOW)
       - Risk: Inconsistent state between cached and fresh data
       - Mitigation: Versioned API responses, ETags, conflict resolution UI
    
    6. **First Load Performance** (LOW)
       - Risk: Service worker registration adds overhead on first visit
       - Mitigation: Defer SW registration, optimize SW file size, use app shell pattern
    
  best_practices: |
    **Development Best Practices**:
    - Test on low-end devices and slow networks (throttle in DevTools)
    - Implement stale-while-revalidate pattern for API calls
    - Use versioned cache names (e.g., 'app-v1.2.3') for updates
    - Handle offline state explicitly in UI with user feedback
    - Provide manual sync trigger for users in offline scenarios
    - Set cache expiration policies (time-based or size-based)
    - Use HTTPS everywhere (required for service workers)
    - Implement proper error boundaries and fallback UI
    
    **Performance Optimizations**:
    - Code splitting and lazy loading for large apps
    - Image optimization and responsive images (srcset)
    - Preload critical resources, prefetch likely navigation
    - Minimize service worker file size (under 50KB)
    - Use CDN for static assets with long cache headers
    
    **User Experience**:
    - Show install prompt at appropriate moments (not immediately)
    - Provide offline indicator in UI (badge, banner, icon)
    - Implement pull-to-refresh or refresh button
    - Use optimistic UI updates with rollback on failure
    - Add loading skeletons for perceived performance
    
  anti_patterns: |
    **Common Mistakes to Avoid**:
    - âŒ Caching everything without strategy (exceeds storage limits)
    - âŒ Not handling offline state in UI (users confused)
    - âŒ Ignoring iOS Safari differences (50% of mobile users)
    - âŒ No cache eviction strategy (storage grows indefinitely)
    - âŒ Blocking main thread with service worker registration
    - âŒ Using sessionStorage for persistent data (cleared on close)
    - âŒ Not versioning API endpoints (breaking changes hurt cached clients)
    - âŒ Caching authenticated API responses (security risk)
    - âŒ Not testing offline scenarios during development
    - âŒ Skipping HTTPS in development (SW won't work)

recommended_tools:
  - name: "Workbox"
    purpose: "Service worker library with caching strategies"
    url: "https://developers.google.com/web/tools/workbox"
  
  - name: "Lighthouse"
    purpose: "PWA auditing and performance testing"
    url: "https://developers.google.com/web/tools/lighthouse"
  
  - name: "PWA Builder"
    purpose: "Generate manifest, service worker, and app packages"
    url: "https://www.pwabuilder.com"
  
  - name: "Dexie.js"
    purpose: "IndexedDB wrapper for easier data management"
    url: "https://dexie.org"
  
  - name: "Can I Use PWA"
    purpose: "Check PWA feature browser support"
    url: "https://caniuse.com/serviceworkers"

testing_checklist:
  - "âœ… Works offline (airplane mode test)"
  - "âœ… Installable on Android and iOS"
  - "âœ… Push notifications work (Android only)"
  - "âœ… Fast loading (Lighthouse score >90)"
  - "âœ… Data syncs when back online"
  - "âœ… Handles poor network conditions (3G throttle)"
  - "âœ… Cache updates properly on new version"
  - "âœ… Storage quota doesn't exceed limits"
  - "âœ… HTTPS everywhere (including dev)"
  - "âœ… Works on low-end devices (throttle CPU 6x)"
